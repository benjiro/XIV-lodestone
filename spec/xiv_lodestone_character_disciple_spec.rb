require 'spec_helper'
require 'xiv_lodestone/lodestone_character_disciple'

describe XIVLodestone::DiscipleList do
  let (:valid) {
    XIVLodestone::DiscipleList.new(Nokogiri::HTML(open(LOCAL_FILE)).xpath("//table[@class='class_list']/tr/td"))
  }
  let (:invalid) {
    XIVLodestone::DiscipleList.new(Nokogiri::HTML(open(INVALID_FILE)).xpath("//table[@class='class_list']/tr/td"))
  }

  it 'Dump json of disciples' do
    expect(valid.to_json).to eq("{\":gladiator\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Gladiator\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/ec5d264e53ea7749d916d7d8bc235ec9c8bb7b51.png?1367039495\"},\":pugilist\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Pugilist\",\"level\":6,\"current_exp\":429,\"total_exp\":4200,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/9fe08b7e2827a51fc216e6407646ffba716a44b8.png?1367039495\"},\":marauder\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Marauder\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/5ca476c2166b399e3ec92e8008544fdbea75b6a2.png?1367039495\"},\":lancer\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Lancer\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/924ded09293b2a04c4cd662afbf7cda7b0576888.png?1367039495\"},\":archer\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Archer\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/d39804e8810aa3d8e467b7a476d01965510c5d18.png?1367039495\"},\":rogue\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Rogue\",\"level\":0,\"current_exp\":0,\"total_exp\":0,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/2d0ac2fdb4fd432d6b91acd7afbc335e87e877fb.png?1414484314\"},\":conjurer\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Conjurer\",\"level\":50,\"current_exp\":0,\"total_exp\":0,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/6157497a98f55a73af4c277f383d0a23551e9e98.png?1367039495\"},\":thaumaturge\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Thaumaturge\",\"level\":26,\"current_exp\":244,\"total_exp\":109800,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/e2a98c81ca279607fc1706e5e1b11bc08cac2578.png?1367039495\"},\":arcanist\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Arcanist\",\"level\":50,\"current_exp\":0,\"total_exp\":0,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/59fde9fca303490477962039f6cd0d0101caeabe.png?1367039495\"},\":carpenter\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Carpenter\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/d41cb306af74bb5407bc74fa865e9207a5ce4899.png?1367039495\"},\":blacksmith\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Blacksmith\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/6e0223f41a926eab7e6bc42af7dd29b915999db1.png?1367039495\"},\":armorer\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Armorer\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/aab4391a4a5633684e1b93174713c1c52f791930.png?1367039495\"},\":goldsmith\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Goldsmith\",\"level\":22,\"current_exp\":1910,\"total_exp\":71400,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/605aa74019178eef7d8ba790b3db10ac8e9cd4ca.png?1367039495\"},\":leatherworker\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Leatherworker\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/f358b50ff0a1b1dcb67490ba8f4c480e01e4edd7.png?1367039495\"},\":weaver\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Weaver\",\"level\":16,\"current_exp\":26199,\"total_exp\":35400,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/131b914b2be4563ec76b870d1fa44aa8da0f1ee6.png?1367039495\"},\":alchemist\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Alchemist\",\"level\":20,\"current_exp\":36457,\"total_exp\":56600,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/343bce834add76f5d714f33154d0c70e99d495a3.png?1367039495\"},\":culinarian\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Culinarian\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/86f1875ebc31f88eb917283665be128689a9669b.png?1367039495\"},\":miner\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Miner\",\"level\":1,\"current_exp\":0,\"total_exp\":300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/8e82259fcd979378632cde0c9767c15dba3790af.png?1367039495\"},\":botanist\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Botanist\",\"level\":50,\"current_exp\":0,\"total_exp\":0,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/937d3313d9d7ef491319c38a4d4cde4035eb1ab3.png?1367039495\"},\":fisher\":{\"^o\":\"XIVLodestone::DiscipleList::Disciple\",\"name\":\"Fisher\",\"level\":5,\"current_exp\":1025,\"total_exp\":2300,\"icon_url\":\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/289dbc0b50956ce10a2195a75a22b500a648284e.png?1367039495\"}}")
    expect(invalid.to_json).to eq("{}")
  end

  it 'Build a disciple' do
    d = XIVLodestone::DiscipleList::Disciple.new("Rogue", 1, 0, 300, "http")
    expect(d.name).to eq("Rogue")
    expect(d.level).to eq(1)
    expect(d.current_exp).to eq(0)
    expect(d.total_exp).to eq(300)
    expect(d.icon_url).to eq("http")
    expect(d.next_level).to eq(300)
  end
end