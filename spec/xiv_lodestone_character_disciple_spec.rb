require 'spec_helper'
require 'xiv_lodestone/lodestone_character_disciple'

describe XIVLodestone::DiscipleList do
  let (:valid) {
    XIVLodestone::DiscipleList.new(Nokogiri::HTML(open(LOCAL_FILE)).xpath("//table[@class='class_list']/tr/td"))
  }
  let (:invalid) {
    XIVLodestone::DiscipleList.new(Nokogiri::HTML(open(INVALID_FILE)).xpath("//table[@class='class_list']/tr/td"))
  }

  it 'Dump json of disciples' do
    expect(valid.to_json).to eq("{\"gladiator\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Gladiator\\\", level=1, current_exp=0, total_exp=300, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/ec5d264e53ea7749d916d7d8bc235ec9c8bb7b51.png?1367039495\\\">\",\"pugilist\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Pugilist\\\", level=60, current_exp=0, total_exp=0, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/9fe08b7e2827a51fc216e6407646ffba716a44b8.png?1367039495\\\">\",\"marauder\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Marauder\\\", level=1, current_exp=0, total_exp=300, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/5ca476c2166b399e3ec92e8008544fdbea75b6a2.png?1367039495\\\">\",\"lancer\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Lancer\\\", level=15, current_exp=279, total_exp=30500, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/924ded09293b2a04c4cd662afbf7cda7b0576888.png?1367039495\\\">\",\"archer\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Archer\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/d39804e8810aa3d8e467b7a476d01965510c5d18.png?1367039495\\\">\",\"rogue\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Rogue\\\", level=0, current_exp=0, total_exp=0, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/2d0ac2fdb4fd432d6b91acd7afbc335e87e877fb.png?1427347185\\\">\",\"conjurer\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Conjurer\\\", level=60, current_exp=0, total_exp=0, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/6157497a98f55a73af4c277f383d0a23551e9e98.png?1367039495\\\">\",\"thaumaturge\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Thaumaturge\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/e2a98c81ca279607fc1706e5e1b11bc08cac2578.png?1367039495\\\">\",\"arcanist\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Arcanist\\\", level=50, current_exp=666000, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/59fde9fca303490477962039f6cd0d0101caeabe.png?1367039495\\\">\",\"dark_knight\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Dark Knight\\\", level=30, current_exp=0, total_exp=162500, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/a2a6213832a266f8c5145f7cbb8b8e8c9d8c6e25.png?1434679077\\\">\",\"machinist\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Machinist\\\", level=30, current_exp=0, total_exp=162500, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/2f21a984aab9ff20acc2cc9bcf0ffe544a33f3a1.png?1434679077\\\">\",\"astrologian\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Astrologian\\\", level=52, current_exp=53648, total_exp=1267200, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/970e5301281cba4ce374530f5949b74d7df083af.png?1434679077\\\">\",\"carpenter\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Carpenter\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/d41cb306af74bb5407bc74fa865e9207a5ce4899.png?1367039495\\\">\",\"blacksmith\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Blacksmith\\\", level=50, current_exp=12660, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/6e0223f41a926eab7e6bc42af7dd29b915999db1.png?1367039495\\\">\",\"armorer\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Armorer\\\", level=52, current_exp=515795, total_exp=1267200, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/aab4391a4a5633684e1b93174713c1c52f791930.png?1367039495\\\">\",\"goldsmith\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Goldsmith\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/605aa74019178eef7d8ba790b3db10ac8e9cd4ca.png?1367039495\\\">\",\"leatherworker\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Leatherworker\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/f358b50ff0a1b1dcb67490ba8f4c480e01e4edd7.png?1367039495\\\">\",\"weaver\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Weaver\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/131b914b2be4563ec76b870d1fa44aa8da0f1ee6.png?1367039495\\\">\",\"alchemist\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Alchemist\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/343bce834add76f5d714f33154d0c70e99d495a3.png?1367039495\\\">\",\"culinarian\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Culinarian\\\", level=50, current_exp=0, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/86f1875ebc31f88eb917283665be128689a9669b.png?1367039495\\\">\",\"miner\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Miner\\\", level=60, current_exp=0, total_exp=0, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/8e82259fcd979378632cde0c9767c15dba3790af.png?1367039495\\\">\",\"botanist\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Botanist\\\", level=50, current_exp=50703, total_exp=864000, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/937d3313d9d7ef491319c38a4d4cde4035eb1ab3.png?1367039495\\\">\",\"fisher\":\"#<struct XIVLodestone::DiscipleList::Disciple name=\\\"Fisher\\\", level=60, current_exp=0, total_exp=0, icon_url=\\\"http://img.finalfantasyxiv.com/lds/pc/global/images/class/24/289dbc0b50956ce10a2195a75a22b500a648284e.png?1367039495\\\">\"}")
    expect(invalid.to_json).to eq("{}")
    expect(valid.to_json.is_a?(String)).to eq(true)
  end

  it 'method missing check' do
    expect(valid.method_missing(:rogue).is_a?(XIVLodestone::DiscipleList::Disciple)).to eql(true)
    expect(valid.method_missing(:goldsmith).is_a?(XIVLodestone::DiscipleList::Disciple)).to eql(true)
    expect(valid.method_missing(:arcanist).is_a?(XIVLodestone::DiscipleList::Disciple)).to eql(true)
  end

  it 'Build a disciple' do
    d = XIVLodestone::DiscipleList::Disciple.new("Rogue", 1, 0, 300, "http")
    expect(d.name).to eq("Rogue")
    expect(d.level).to eq(1)
    expect(d.current_exp).to eq(0)
    expect(d.total_exp).to eq(300)
    expect(d.icon_url).to eq("http")
    expect(d.next_level).to eq(300)
  end
end
